
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>citizen428.blog()</title>
  <meta name="author" content="Michael Kohl">

  
  <meta name="description" content="I&#8217;ve been toying around with the idea for a small website lately, but never actually got around to do it. In an attempt to clear out my &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://citizen428.github.io/posts/25">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="citizen428.blog()" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<meta name="google-site-verification" content="bArHZu2u3n3GxMD_LR02GfyzeA-nYFOuaBuDbfJT07U" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1416057-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">citizen428.blog()</a></h1>
  
    <h2>Try to learn something about everything</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:citizen428.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about/">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/talks_and_publications">Output</a></li>
  <li><a href="/studynotes">Study Notes</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/imprint/">Imprint</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/06/fun-with-sinatra-heroku-and-mongodb/">Fun With Sinatra, Heroku and MongoDB</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-06T00:00:00+07:00" pubdate data-updated="true">Dec 6<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been toying around with the idea for a small website lately, but never actually got around to do it. In an attempt to clear out my personal to do list I finally motivated myself to start yesterday, and I have to say the following combination of tools is not only insanely efficient, but also really fun to work with:<br />
<ul><br />
<li><a href="http://www.sinatrarb.com/">Sinatra</a>, <i>&#8220;a <span class="caps">DSL</span> for quickly creating web applications in Ruby with minimal effort&#8221;</i>. I recommend using it in combination with <a href="http://mongrel.rubyforge.org/">Mongrel</a>, <a href="http://github.com/rtomayko/shotgun">Shotgun</a> and <a href="http://haml-lang.com/">Haml</a>.</li><br />
<li><a href="http://heroku.com/">Heroku</a>, a Ruby cloud hosting platform. Small sites are for free and Heroku&#8217;s git-based workflow just feels so natural. You can also <a href="http://docs.heroku.com/gems">manage your gem dependencies</a> and <a href="http://docs.heroku.com/config-vars">set up environment variables</a>, which made my life a whole lot easier.</li><br />
<li><a href="http://www.mongodb.org">MongoDB</a>, <i>&#8220;a scalable, high-performance, open source, schema-free, document-oriented database&#8221;</i>. In this specific case I used <a href="http://www.mongohq.com/home">MongoHQ</a> for the database hosting, since they were nice enough to provide me with a beta account. I stored all the connection information for MongoHQ in environment variables as described above:</p><br />
<script src="http://gist.github.com/250193.js?file=mongohq.rb"></script></p>
</ul>
<p>With this combination I was able to go from zero to mostly finished (I still need to write some of the content and make/steal a stylesheet) in very little time, while actually having fun! Thanks everybody for providing the Ruby community which such awesome tools! :-)</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/01/gravedigging-why-the-lucky-stiff-io-has-a-very-clean-mirror/">Gravedigging Why the Lucky Stiff: Io Has a Very Clean Mirror</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-01T00:00:00+07:00" pubdate data-updated="true">Dec 1<sup>st</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.iolanguage.com/">Io</a> is a small small, prototype-based OO programming language that&#8217;s fun to play with. Unfortunately there&#8217;s not too much information about it out there and quite predictably googling for &#8220;io&#8221; gets you lots of results you are <strong>not</strong> looking for. But today I remembered that <a href="http://en.wikipedia.org/wiki/Why_the_lucky_stiff">why</a> once did a nice little article on the language, and thanks to the amazing <a href="http://www.archive.org/">Internet Archive</a> I actually managed to find it! So without further ado, here we go:</p>
	<p><a href="http://web.archive.org/web/20080106163631/http://hackety.org/2008/01/05/ioHasAVeryCleanMirror.html">Io Has A Very Clean Mirror</a></p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/23/fun-with-twitter-and-ruby/">Fun With Twitter and Ruby</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-23T00:00:00+07:00" pubdate data-updated="true">Nov 23<sup>rd</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m currently toying around with some ideas for Twitter bots etc. so I had a look at some of the available gems out there. Sometimes Ruby makes stuff almost too simple&#8230; ;-) Here are a few nice snippets of what you could do with a couple of minutes time and some Ruby:</p>
<p><em>Automatically translate all tweets for a given keyword:</em> <br />
<script src="http://gist.github.com/241437.js?file=gistfile1.rb"></script></p>
<p><em>Daemonize the above:</em><br />
Alternatively you can also follow a userid instead of a keyword and daemonize the whole thing, thus making it super easy to create a bot which posts translations of Matz&#8217;s tweets:</p>
<script src="http://gist.github.com/241437.js?file=gistfile2.rb"></script><p>If you put this into a file like transbot.rb,  the command ruby transbot.rb will give you all the regular daemon commands like start, stop, etc.</p>
<p><em>Ruby is trendy:</em><br />
Curious of getting a list of current trends on Twitter, without hashtags? There you go:<br />
<script src="http://gist.github.com/241437.js?file=gistfile3.rb"></script><br />
Combining all these ideas you could easily write a bot that follows the current Twitter trends and posts translations of them in only a couple of lines. :-)</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/19/fixing-macports-on-snow-leopard/">Fixing MacPorts on Snow Leopard</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-19T00:00:00+07:00" pubdate data-updated="true">Oct 19<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">	<p>After upgrading to Snow Leopard I had quite a bit of trouble with my <a href="http://www.macports.org/">MacPorts</a> installation, since most builds just failed with configure errors. After the obvious first steps of installing a newer version for SL and making sure I have the most recent XCode, I was a bit stumped until I finally found this site:</p>
	<p><a href="http://trac.macports.org/wiki/Migration">Migrating a MacPorts install to a new major OS version or <span class="caps">CPU</span> architecture</a></p>
	<p>After finding this guide &#8211; which btw really solved my problems &#8211; I felt a bit stupid, but since I didn&#8217;t have to do anything after the Tiger&#8594;Leopard upgrade, I really didn&#8217;t expect this.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/10/attempted-peace/">Attempted Peace</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-10T00:00:00+07:00" pubdate data-updated="true">Oct 10<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><i>Sideshow Bob</i>: Attempted murder? Now honestly, what is that? Do they give a Nobel prize for attempted chemistry? Do they?</p>
<p>Nope, only for attempted peace it seems.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/06/whats-new-pussycat/">What&#8217;s New Pussycat?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-06T00:00:00+07:00" pubdate data-updated="true">Oct 6<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quite a bit actually:<ul><br />
<li>I live in Vienna again. Seriously.</li><br />
<li>I started my new job as IT systems engineer at <a href="http://www.nessus.at/">Nessus</a>. <b>Update</b>: That was October. In November I changed job and now work for <a href="http://matrixware.com">Matrixware</a> </li><br />
<li><a href="http://github.com/citizen428/ClojureX">ClojureX</a> got mentioned in the <a href="http://github.com/citizen428/ClojureX">latest GitHub rebase</a>, yeah!</li><br />
<li><a href="http://github.com/citizen428/unsavory">unsavory</a> is now also available on <a href="http://gemcutter.org/">Gemcutter</a>, so get it while it&#8217;s hot (Disclaimer: product may not be as hot as advertised, <span class="caps">YMMV</span>).</li><br />
<li><a href="http://rubylearning.org">RubyLearning</a> started a <a href="http://rubylearning.com/blog/2009/09/20/rpcfn-ruby-programming-challenge-for-newbies/">Ruby Programming Challenge for Newbies</a> and I&#8217;m part of the jury. The <a href="http://rubylearning.com/blog/2009/09/24/rpcfn-shift-subtitle-1/">first challenge</a> was provided by <a href="http://www.akitaonrails.com/">Fabio Akita</a> and saw quite a lot of participants. I also wrote a quick <a href="http://github.com/citizen428/rubylearning/blob/master/rpcfn/01subtitles/subtitles.rb">example solution</a>.</li></p>
</ul></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/08/unsavory-now-available-as-gem/">Unsavory Now Available as Gem</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-08T00:00:00+07:00" pubdate data-updated="true">Sep 8<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://github.com/citizen428/unsavory/tree/master">unsavory</a> is now available as a gem, which means that you can comfortably install it like this:<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem sources -a http://gems.github.com 
</span><span class='line'>$ sudo gem install citizen428-unsavory</span></code></pre></td></tr></table></div></figure></div><br />
Rubygems will automatically create a wrapper-script named &#8220;unsavory&#8221;, which you can use to start the program so you finally can get rid of all these outdated bookmarks.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/06/using-java-libraries-from-clojure/">Using Java Libraries From Clojure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-06T00:00:00+07:00" pubdate data-updated="true">Sep 6<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><br />
After reading <a href="http://www.engineyard.com/blog/2009/scripting-java-libraries-with-jruby/">Scripting Java Libraries With Ruby</a> on the <a href="http://www.engineyard.com/">Engine Yard blog</a>, I decided to translate the two example programs to Clojure. Please keep in mind though that I&#8217;m pretty much a Clojure newbie myself, so the code shown here might not be very idiomatic. In case you have any suggestions on how to improve the code examples presented here, please leave a comment, thank you! To get the most out of this post, you should probably read the <a href="http://java.ociweb.com/mark/clojure/article.html#JavaInterop">section on Java Interoperability</a> in <a href="http://java.ociweb.com/mark/">Mark Volkmann</a>&#8216;s excellent <a href="http://java.ociweb.com/mark/clojure/article.html">Clojure tutorial</a> first.<br />
<p><b>A <span class="caps">MIDI</span> Keyboard</b></p><br />
The first example listens for a line of text which then gets converted into a playable <span class="caps">MIDI</span> sequence. Let&#8217;s start with importing the classes we need.<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(ns midi/keyboard
</span><span class='line'>  (:import [javax.sound.midi MidiSystem Sequence MidiEvent ShortMessage])
</span><span class='line'>  (:use [clojure.contrib.seq-utils :only (indexed)]))</span></code></pre></td></tr></table></div></figure></div><br />
<br />
Next we set up a <a href="http://clojure.org/special_forms#toc9">loop</a> and an exit clause.  In case the user enters the word &#8220;exit&#8221;, we call System.exit to shut down all the threads that got started by Java&#8217;s <span class="caps">MIDI</span> support.<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(loop [line (read-line)]
</span><span class='line'>  (if (re-find #"exit" line) (System/exit 0))
</span><span class='line'>  ... other code snipped...
</span><span class='line'>  (recur (read-line)))</span></code></pre></td></tr></table></div></figure></div><br />
<br />
The main part of the application constructs a new <span class="caps">MIDI</span> sequence by creating a NOTE_ON event for every character in the entered text and then finishing the sequence with a <span class="caps">STOP</span> event. The original article states that it favors simplicity over efficiency, so the same also holds true for my &#8220;translation&#8221;.<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(def sq (Sequence. Sequence/PPQ 2))
</span><span class='line'>  (def track (.createTrack sq))
</span><span class='line'>  (doseq [[idx note] (indexed line)]
</span><span class='line'>    (let [msg (ShortMessage.)]
</span><span class='line'>      (.setMessage msg ShortMessage/NOTE_ON (int note) 64)
</span><span class='line'>      (.add track (MidiEvent. msg idx))))
</span><span class='line'>  (let [msg (ShortMessage.)]
</span><span class='line'>    (.setMessage msg ShortMessage/STOP)
</span><span class='line'>    (.add track (MidiEvent. msg (+ (.length line) 1))))</span></code></pre></td></tr></table></div></figure></div><br />
<br />
To finish off our first program we play the sequence before prompting for more input (see the loop snippet above).<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(doto (MidiSystem/getSequencer)
</span><span class='line'>    (.open)
</span><span class='line'>    (.setSequence sq)
</span><span class='line'>    (.start))</span></code></pre></td></tr></table></div></figure></div><br />
<br />
<a href="http://github.com/citizen428/codequickies/blob/master/clojure/midi/keyboard.clj">Full source for the first example</a><br />
<p><b>Making It More Interactive</b></p><br />
While the first example was fun, it wasn&#8217;t as interactive as it could be. Therefore the second program launches a <span class="caps">GUI</span> window to receive keystroke events, turning a note on or off when a key is pressed or released. Since we don&#8217;t have to create <span class="caps">MIDI</span> sequences this time, our import statement becomes a lot shorter:<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(ns midi/interactive
</span><span class='line'>  (:import [javax.sound.midi MidiSystem]
</span><span class='line'>           [javax.swing JFrame] [java.awt.event KeyListener]))</span></code></pre></td></tr></table></div></figure></div><br />
<br />
This example directly accesses the system synthesizer. The following lines open the default synthesizer&#8217;s channel 0 (and also create a JFrame object which we&#8217;ll use later):<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(let [synth (MidiSystem/getSynthesizer)
</span><span class='line'>      frame (JFrame. "Music Frame")]
</span><span class='line'>  (.open synth)
</span><span class='line'>  (let [channel (aget (.getChannels synth) 0)]</span></code></pre></td></tr></table></div></figure></div><br />
<br />
We then launch a <span class="caps">GUI</span> frame as a simple and cross-platform way to receive keystroke events. The KeyListener interface is implemented using Clojure&#8217;s <a href="http://clojure.org/java_interop#toc26">proxy macro</a>, using keyPressed and keyReleased events to turn notes on or off.<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(doto frame
</span><span class='line'>      (.setSize 300 300)
</span><span class='line'>      (.setDefaultCloseOperation JFrame/EXIT_ON_CLOSE)
</span><span class='line'>      (.addKeyListener
</span><span class='line'>       (proxy [KeyListener] []
</span><span class='line'>         (keyPressed [e]
</span><span class='line'>                     (.noteOn channel (int (.getKeyChar e)) 64))
</span><span class='line'>         (keyReleased [e]
</span><span class='line'>                      (.noteOff channel (int (.getKeyChar e))))
</span><span class='line'>         (keyTyped [e])))</span></code></pre></td></tr></table></div></figure></div><br />
<br />
Last but not least we display our frame to let the fun begin.<br />
<div class='bogus-wrapper'><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(.setVisible true))))</span></code></pre></td></tr></table></div></figure></div><br />
<a href="http://github.com/citizen428/codequickies/blob/master/clojure/midi/interactive.clj">Full source for the second example</a><br />
<br />
<br />
I hope this article helped to illustrate how easy it is to use the plethora of existing Java libraries from Clojure. In case you have any feedback or questions, please feel free to leave a comment!</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/06/using-java-libraries-from-clojure/">Using Java Libraries From Clojure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-06T00:00:00+07:00" pubdate data-updated="true">Sep 6<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After reading <a href="http://www.engineyard.com/blog/2009/scripting-java-libraries-with-jruby/">Scripting Java Libraries With Ruby</a> on the <a href="http://www.engineyard.com/">Engine Yard blog</a>, I decided to translate the two example programs to Clojure. Please keep in mind though that I&rsquo;m pretty much a Clojure newbie myself, so the code shown here might not be very idiomatic. In case you have any suggestions on how to improve the code examples presented here, please leave a comment, thank you! To get the most out of this post, you should probably read the <a href="http://java.ociweb.com/mark/clojure/article.html#JavaInterop">section on Java Interoperability</a> in <a href="http://java.ociweb.com/mark/">Mark Volkmann</a>&rsquo;s excellent <a href="http://java.ociweb.com/mark/clojure/article.html">Clojure tutorial</a> first.</p>

<p><b>A MIDI Keyboard</b></p>


<p>The first example listens for a line of text which then gets converted into a playable MIDI sequence. Let&rsquo;s start with importing the classes we need.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">ns</span> <span class="nv">midi/keyboard</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">:import</span> <span class="p">[</span><span class="nv">javax</span><span class="o">.</span><span class="nv">sound</span><span class="o">.</span><span class="nv">midi</span> <span class="nv">MidiSystem</span> <span class="nv">Sequence</span> <span class="nv">MidiEvent</span> <span class="nv">ShortMessage</span><span class="p">])</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">:use</span> <span class="p">[</span><span class="nv">clojure</span><span class="o">.</span><span class="nv">contrib</span><span class="o">.</span><span class="nv">seq-utils</span> <span class="nv">:only</span> <span class="p">(</span><span class="nf">indexed</span><span class="p">)]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we set up a <a href="http://clojure.org/special_forms#toc9">loop</a> and an exit clause.  In case the user enters the word &ldquo;exit&rdquo;, we call System.exit to shut down all the threads that got started by Java&rsquo;s MIDI support.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nb">loop </span><span class="p">[</span><span class="nv">line</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">re-find </span><span class="o">#</span><span class="s">&quot;exit&quot;</span> <span class="nv">line</span><span class="p">)</span> <span class="p">(</span><span class="nf">System/exit</span> <span class="mi">0</span><span class="p">))</span>
</span><span class='line'>  <span class="o">...</span> <span class="nv">other</span> <span class="nv">code</span> <span class="nv">snipped</span><span class="o">...</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The main part of the application constructs a new MIDI sequence by creating a NOTE_ON event for every character in the entered text and then finishing the sequence with a STOP event. The original article states that it favors simplicity over efficiency, so the same also holds true for my &ldquo;translation&rdquo;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="p">(</span><span class="k">def </span><span class="nv">sq</span> <span class="p">(</span><span class="nf">Sequence</span><span class="o">.</span> <span class="nv">Sequence/PPQ</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">def </span><span class="nv">track</span> <span class="p">(</span><span class="o">.</span><span class="nv">createTrack</span> <span class="nv">sq</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">doseq </span><span class="p">[[</span><span class="nv">idx</span> <span class="nv">note</span><span class="p">]</span> <span class="p">(</span><span class="nf">indexed</span> <span class="nv">line</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">msg</span> <span class="p">(</span><span class="nf">ShortMessage</span><span class="o">.</span><span class="p">)]</span>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">setMessage</span> <span class="nv">msg</span> <span class="nv">ShortMessage/NOTE_ON</span> <span class="p">(</span><span class="nb">int </span><span class="nv">note</span><span class="p">)</span> <span class="mi">64</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">add</span> <span class="nv">track</span> <span class="p">(</span><span class="nf">MidiEvent</span><span class="o">.</span> <span class="nv">msg</span> <span class="nv">idx</span><span class="p">))))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">msg</span> <span class="p">(</span><span class="nf">ShortMessage</span><span class="o">.</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="o">.</span><span class="nv">setMessage</span> <span class="nv">msg</span> <span class="nv">ShortMessage/STOP</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="o">.</span><span class="nv">add</span> <span class="nv">track</span> <span class="p">(</span><span class="nf">MidiEvent</span><span class="o">.</span> <span class="nv">msg</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="o">.</span><span class="nv">length</span> <span class="nv">line</span><span class="p">)</span> <span class="mi">1</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>To finish off our first program we play the sequence before prompting for more input (see the loop snippet above).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="p">(</span><span class="nb">doto </span><span class="p">(</span><span class="nf">MidiSystem/getSequencer</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="o">.</span><span class="nv">open</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="o">.</span><span class="nv">setSequence</span> <span class="nv">sq</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="o">.</span><span class="nv">start</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://github.com/citizen428/codequickies/blob/master/clojure/midi/keyboard.clj">Full source for the first example</a></p>

<p><b>Making It More Interactive</b></p>


<p>While the first example was fun, it wasn&rsquo;t as interactive as it could be. Therefore the second program launches a GUI window to receive keystroke events, turning a note on or off when a key is pressed or released. Since we don&rsquo;t have to create MIDI sequences this time, our import statement becomes a lot shorter:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">ns</span> <span class="nv">midi/interactive</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">:import</span> <span class="p">[</span><span class="nv">javax</span><span class="o">.</span><span class="nv">sound</span><span class="o">.</span><span class="nv">midi</span> <span class="nv">MidiSystem</span><span class="p">]</span>
</span><span class='line'>           <span class="p">[</span><span class="nv">javax</span><span class="o">.</span><span class="nv">swing</span> <span class="nv">JFrame</span><span class="p">]</span> <span class="p">[</span><span class="nv">java</span><span class="o">.</span><span class="nv">awt</span><span class="o">.</span><span class="nv">event</span> <span class="nv">KeyListener</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This example directly accesses the system synthesizer. The following lines open the default synthesizer&rsquo;s channel 0 (and also create a JFrame object which we&rsquo;ll use later):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">synth</span> <span class="p">(</span><span class="nf">MidiSystem/getSynthesizer</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">frame</span> <span class="p">(</span><span class="nf">JFrame</span><span class="o">.</span> <span class="s">&quot;Music Frame&quot;</span><span class="p">)]</span>
</span><span class='line'>  <span class="p">(</span><span class="o">.</span><span class="nv">open</span> <span class="nv">synth</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">channel</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="o">.</span><span class="nv">getChannels</span> <span class="nv">synth</span><span class="p">)</span> <span class="mi">0</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure>


<p>We then launch a GUI frame as a simple and cross-platform way to receive keystroke events. The KeyListener interface is implemented using Clojure&rsquo;s <a href="http://clojure.org/java_interop#toc26">proxy macro</a>, using keyPressed and keyReleased events to turn notes on or off.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nb">doto </span><span class="nv">frame</span>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">setSize</span> <span class="mi">300</span> <span class="mi">300</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">setDefaultCloseOperation</span> <span class="nv">JFrame/EXIT_ON_CLOSE</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">addKeyListener</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">proxy </span><span class="p">[</span><span class="nv">KeyListener</span><span class="p">]</span> <span class="p">[]</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">keyPressed</span> <span class="p">[</span><span class="nv">e</span><span class="p">]</span>
</span><span class='line'>                     <span class="p">(</span><span class="o">.</span><span class="nv">noteOn</span> <span class="nv">channel</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="o">.</span><span class="nv">getKeyChar</span> <span class="nv">e</span><span class="p">))</span> <span class="mi">64</span><span class="p">))</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">keyReleased</span> <span class="p">[</span><span class="nv">e</span><span class="p">]</span>
</span><span class='line'>                      <span class="p">(</span><span class="o">.</span><span class="nv">noteOff</span> <span class="nv">channel</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="o">.</span><span class="nv">getKeyChar</span> <span class="nv">e</span><span class="p">))))</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">keyTyped</span> <span class="p">[</span><span class="nv">e</span><span class="p">])))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Last but not least we display our frame to let the fun begin.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>      <span class="p">(</span><span class="o">.</span><span class="nv">setVisible</span> <span class="nv">true</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://github.com/citizen428/codequickies/blob/master/clojure/midi/interactive.clj">Full source for the second example</a><br>
I hope this article helped to illustrate how easy it is to use the plethora of existing Java libraries from Clojure. In case you have any feedback or questions, please feel free to leave a comment!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/26/first-small-clojure-program/">First Small Clojure Program</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-26T00:00:00+07:00" pubdate data-updated="true">Aug 26<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">	<p>After I recently got interested in Clojure, I decided to use it for a small &#8220;project&#8221;, namely a script which will download all the enclosures from an <span class="caps">RSS</span> 2.0 feed to the current working directory. The <a href="https://github.com/citizen428/codequickies/blob/master/clojure/rss/fetcher.clj">program</a> itself is very concise, with only 9 lines of actual code (the rest are comments and library imports). </p>
	<p>My impressions: for somebody with little previous exposure to <a href="http://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a> (some <a href="http://en.wikipedia.org/wiki/Common_lisp">CL</a> and very little <a href="http://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a>) and no Java background the learning curve can be a bit steep in the beginning, especially since documentation is still a bit (too) sparse. However, if you are willing to spend some time on Google or reading the actual source code of Clojure and clojure-contrib you&#8217;ll generally find what you are looking for. Besides that people in the Clojure community seem to be quite friendly and my question on #clojure got satisfactorily answered within a minute. </p>
	<p>It&#8217;s a definitely too early for any real assessment of the language, but I quite like what I saw so far, so there probably will be some more Clojure-related posts in the near future. </p>
	<p>Some links to get you started:<br />
<a href="http://clojure.org/api">Clojure <span class="caps">API</span></a><br />
<a href="http://richhickey.github.com/clojure-contrib/">An overview of clojure.contrib</a><br />
<a href="http://java.ociweb.com/mark/clojure/article.html">Clojure &#8211; Functional Programming for the <span class="caps">JVM</span></a><br />
<a href="http://mattsears.com/2009/6/6/20-clojure-links-to-get-you-up-to-speed">20 Clojure links to get you up to speed</a><br />
<a href="http://lifeofaprogrammergeek.blogspot.com/2009/03/learning-clojure-and-emacs.html">Learning Clojure and Emacs</a></p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/26">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/24">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About citizen428</h1>
  <p>I&#8217;m Michael Kohl, generally known as citizen428 online. I mainly
  write about programming, and do a regular <a href="/blog/categories/informationoverload/">blog post series</a> collecting interesting
  articles I enjoyed throughout the week.</p>
<div id="social_media_icons" align="center">
<a href="http://twitter.com/citizen428"><img src="/images/icons/twitter.png"
                                             alt="Twitter" /></a>
<a href="https://plus.google.com/u/0/101046237539584353961/posts"><img src="/images/icons/google.png"
                                             alt="Twitter"
                                             /></a>
<a href="http://www.linkedin.com/in/citizen428"><img src="/images/icons/linkedin.png"
                                             alt="Twitter" /></a>
</div>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/12/information-overload-2015-07-12/">Information Overload 2015-07-12</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/06/information-overload-2015-07-06/">Information Overload 2015-07-06</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/07/information-overload-2015-06-07/">Information Overload 2015-06-07</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/01/information-overload-2015-06-01/">Information Overload 2015-06-01</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/10/information-overload-2015-04-26/">Information Overload 2015-05-10</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("citizen428", 3, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/citizen428" class="twitter-follow-button" data-show-count="true">Follow @citizen428</a>
  
</section>


<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/citizen428">@citizen428</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'citizen428',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Michael Kohl -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'citizen428-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
